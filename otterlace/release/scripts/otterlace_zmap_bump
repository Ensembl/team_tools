#!/bin/bash


#  This updates the zmap version to the current BUILD.DEVELOPMENT or BUILD.PRODUCTION .



. "$( dirname "$0" )/_otterlace.sh"

if [ -z "$(config version_major)" ] || [ -n "$(config version_minor)" ]; then
    bail "Expected to be on a release branch of ensembl-otter (version=$(config version_major).$(config version_minor))"
fi

if [ "$(config track)" = "live" ]; then
    buildlink=BUILD.PRODUCTION
else
    buildlink=BUILD.DEVELOPMENT
fi
zmap_path="$( readlink ~zmap/$buildlink )"
echo "Using ~zmap/$buildlink -> $zmap_path"

$dist_scripts/git-is-synced || bail "The repository is not in sync, aborting"

config_set "zmap_path" "$zmap_path" &&
git commit -a -m "$( printf "New ZMap release: %s from %s.\n\nGenerated by %s\n" "$zmap_path" "$buildlink" "$thisprog" )" &&
git_show_maybe &&
printf "\n\nExpecting you to push now!\n" &&
true

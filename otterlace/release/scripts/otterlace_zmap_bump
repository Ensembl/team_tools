#!/bin/bash


#  This updates the zmap version to the current BUILD.DEVELOPMENT or BUILD.PRODUCTION .



. "$( dirname "$0" )/_otterlace.sh"


# ensure that we find the otterlace_zmap_*_version commands
export PATH=${PATH}:/nfs/anacode/otterlace/bin

if [ -z "$(config version_major)" ] || [ -n "$(config version_minor)" ]; then
    bail "Expected to be on a release branch of ensembl-otter (version=$(config version_major).$(config version_minor))"
fi

if [ "$(config track)" = "live" ]; then
    zmap_version="$( PRODUCTION: $( otterlace_zmap_production_version )"
else
    zmap_version="$( RELEASE: $( otterlace_zmap_release_version )"
fi
echo "Using $zmap_version"

$dist_scripts/git-is-synced || bail "The repository is not in sync, aborting"

config_set "zmap_version" "$zmap_version" &&
git commit -a -m "$( printf "New ZMap release: %s from %s.\n\nGenerated by %s\n" "$zmap_version" "$buildlink" "$thisprog" )" &&
git_show_maybe &&
printf "\n\nExpecting you to push now!\n" &&
true

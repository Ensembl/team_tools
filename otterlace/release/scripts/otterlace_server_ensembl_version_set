#!/bin/bash


# This sets the ensembl version used by the Otterlace CGI scripts.


. "$( dirname "$0" )/_otterlace.sh"


# check the usage
server_ensembl_version="$1"
[ -n "$server_ensembl_version" ] || {
    echo "usage: $( basename "$0" ) <server_ensembl_version>" >&2
    exit 1
}

# check that the repository is clean
{
    git diff --quiet &&
    git diff --quiet --cached &&
    true
} || {
    echo "The repository is not clean: commit outstanding chages and retry." >&2
    exit 1
}

config_set server_ensembl_version "$server_ensembl_version" &&
sed -i \
    -e "/\<SangerPaths\>/s/\<ensembl[[:alnum:]]*\>/ensembl${server_ensembl_version}/" \
    scripts/apache/* &&
git commit -a -m "$( printf "EnsEMBL server version set to %d.\n\nGenerated by %s\n" "$server_ensembl_version" "$thisprog" )" &&
true

#!/bin/bash


# This sets the ensembl version used by the Otterlace CGI scripts,
#   in ensembl-otter/dist/conf/server_ensembl_version
#   in ensembl-otter/scripts/apache/*
#
# The SangerPaths module
#   was last seen at /usr/lib/perl/5.8/SangerPaths.pm on the webserver, so not directly accessible
#   seems to be driven from /nfs/WWWdev/conf/perlconfig.ini (may differ on live)
#   can be checked with SangerPaths->dump
# See also http://search.cpan.org/dist/Module-PortablePath/


. "$( dirname "$0" )/_otterlace.sh" || exit 1


# check the usage
server_ensembl_version="$1"
[ -n "$server_ensembl_version" ] || bail "usage: $( basename "$0" ) <server_ensembl_version>"

config_set server_ensembl_version "$server_ensembl_version" &&
sed -i \
    -e "/\<SangerPaths\>/s/\<ensembl[[:alnum:]]*\>/ensembl${server_ensembl_version}/" \
    scripts/apache/* &&
git commit -a -m "$( printf "Server EnsEMBL version set to %d.\n\nGenerated by %s\n" "$server_ensembl_version" "$thisprog" )" &&
printf "\n\nExpecting you to push now!\n" &&
true

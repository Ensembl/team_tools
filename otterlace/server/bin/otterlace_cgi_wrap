#!/bin/sh

# This script is a wrapper that runs the Otterlace CGI scripts
# locally.  It changes the Perl @INC path to find local versions of
# the SangerPaths and SangerWeb modules.

# Q: Why do this when we could simply set the PERL5LIB environment
# variable?

# A: Because the Otterlace CGI scripts run in taint mode which ignores
# $PERL5LIB.  The only solution is a wrapper that exec()s Perl and
# uses the -I flag to add directories to @INC.

# concept:        Matthew Astley <mca@sanger.ac.uk>
# implementation: Jeremy Henty   <jh13@sanger.ac.uk>


# the path to the Anacode Perl modules
anacode_perl="/nfs/anacode/otterlace/perl"

# the path to our Otterlace server Perl modules
otterlace_server_perl="$( cd "$( dirname "$0")/.." && pwd )/perl"
# echo "\$otterlace_server_perl = '$otterlace_server_perl'" ; exit # uncomment to test

# exec() the real CGI script
exec /software/bin/perl \
    "-I${otterlace_server_perl}" \
    "-I${anacode_perl}" \
    "-I${anacode_perl}/lib/site_perl/5.8.8" \
    -T "$@"

# if we get here, the exec() failed
echo "${0}: failed to exec() ${cgi}" >&2
exit 1
